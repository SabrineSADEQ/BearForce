<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui">

<ui:composition template="WEB-INF/templates/mainTemplate.xhtml">
	<ui:define name="titleValue">Gestion des activités</ui:define>
	<ui:define name="content">
		<div>
			<div class="card crud-demo">
				<h:form id="form">
					<p:growl id="messages" showDetail="true" />

					<p:dataTable id="rud-activity" widgetVar="dtActivities" var="act"
						value="#{equipmentController.getActivitiesList()}" reflow="true"
						styleClass="products-table" paginator="true" rows="10"
						rowSelectMode="add" paginatorPosition="bottom">

						<f:facet name="header">
							<div class="products-table-header">
								<span style="font-weight: bold">LES ACTIVITES</span> <span
									class="filter-container ui-input-icon-left"> <i
									class="pi pi-search"></i> <p:inputText id="globalFilter"
										onkeyup="PF('dtActivities').filter()" placeholder="Recherche" />
								</span>
							</div>
						</f:facet>

						<p:column headerText="Activité" sortBy="#{act.name}"
							filterBy="#{act.name}">
							<p:outputLabel>#{act.name}</p:outputLabel>
						</p:column>

						<p:column headerText="Détails" sortBy="#{act.description}"
							filterBy="#{act.description}">
							<p:outputLabel>#{act.description}</p:outputLabel>
						</p:column>

						<p:column headerText="Catégorie" sortBy="#{act.category}"
							filterBy="#{act.category}">
							<f:facet name="header">Catégorie</f:facet>
							<p:outputLabel>#{act.category}</p:outputLabel>
						</p:column>

						<p:column headerText="Equipement">
							<ul>
								<ui:repeat value="#{act.equipmentList}" var="equi">
									<li><p:outputLabel>#{equi.equipmentName}</p:outputLabel></li>
								</ui:repeat>
							</ul>
						</p:column>

						<p:column exportable="false">
							<p:commandButton icon="pi pi-pencil"
								update=":dialogs:manage-activity-content"
								oncomplete="PF('manageActivityDialog').show()"
								styleClass="edit-button rounded-button ui-button-success"
								process="@this">
								<f:setPropertyActionListener value="#{act}"
									target="#{activityController.selectedActivity}" />
								<p:resetInput target=":dialogs:manage-activity-content" />
							</p:commandButton>
							<p:commandButton class="ui-button-warning rounded-button"
								icon="pi pi-trash" process="@this"
								oncomplete="PF('deleteActivityDialog').show()">
								<f:setPropertyActionListener value="#{act}"
									target="#{activityController.selectedActivity}" />
							</p:commandButton>
						</p:column>

					</p:dataTable>
				</h:form>

				<h:form id="dialogs">
					<p:dialog header="Détails de l'activité" showEffect="fade"
						modal="true" widgetVar="manageActivityDialog" responsive="true">
						<p:outputPanel id="manage-activity-content" class="ui-fluid">
							<p:outputPanel
								rendered="#{not empty activityController.selectedActivity}">
								<div class="field">
									<p:outputLabel for="name">Name</p:outputLabel>
									<p:inputText id="name"
										value="#{activityController.selectedActivity.name}"
										required="true" />
								</div>
								<div class="field">
									<p:outputLabel for="description">Description</p:outputLabel>
									<p:inputTextarea id="description"
										value="#{activityController.selectedActivity.description}" />
								</div>
								<div class="field">
									<p:outputLabel for="category">Categorie</p:outputLabel>
									<p:selectOneMenu id="category"
										value="#{activityController.selectedActivity.category}">
										<f:selectItems
											value="#{activityController.getActivityCategories()}"
											var="cat" itemLabel="#{cat.libelle}" itemValue="#{cat}" />
									</p:selectOneMenu>
								</div>

								<p:selectManyCheckbox id="equipments"
									value="#{activityController.selectedActivity.equipmentList}"
									layout="responsive" columns="2">
									<f:selectItems
										value="#{activityController.getEquipmentsList()}" var="equi"
										itemLabel="#{equi.equipmentName}" itemValue="#{equi.id}" />
								</p:selectManyCheckbox>
							</p:outputPanel>
						</p:outputPanel>

						<f:facet name="footer">
							<p:commandButton value="Save" icon="pi pi-check"
								actionListener="#{activityController.addActivity()}"
								update="manage-activity-content"
								process="manage-activity-content @this" />
							<p:commandButton value="Cancel" icon="pi pi-times"
								onclick="PF('manageActivityDialog').hide()"
								class="ui-button-secondary" type="button" />
						</f:facet>
					</p:dialog>

					<p:confirmDialog widgetVar="deleteActivityDialog" showEffect="fade"
						width="300" message="Supprimer l'activité ?" header="Confirm"
						severity="warn">
						<p:commandButton value="Oui" icon="pi pi-check"
							actionListener="#{activityController.deleteSelectedActivity()}"
							oncomplete="PF('deleteActivityDialog').hide()" />
						<p:commandButton value="No" type="button"
							styleClass="ui-button-secondary" icon="pi pi-times"
							onclick="PF('deleteActivityDialog').hide()" />
					</p:confirmDialog>

					<p:confirmDialog global="true" showEffect="fade" width="300">
						<p:commandButton value="Yes" type="button"
							styleClass="ui-confirmdialog-yes" icon="pi pi-check" />
						<p:commandButton value="No" type="button"
							styleClass="ui-confirmdialog-no ui-button-secondary"
							icon="pi pi-times" />
					</p:confirmDialog>
				</h:form>
				<br />
			</div>
		</div>
	</ui:define>
</ui:composition>
</html>
